{"version":3,"file":"connection-plugin.common.js","sources":["../src/utils.ts","../src/picker/view.ts","../src/picker/index.ts","../src/flow.ts","../src/index.ts"],"sourcesContent":["import { Emitter, Connection } from 'rete';\nimport { EventsTypes } from 'rete/types/events';\n\nfunction toTrainCase(str: string) {\n    return str.toLowerCase().replace(/ /g, '-');\n}\n\nexport function defaultPath(points: number[], curvature: number) {\n    const [x1, y1, x2, y2] = points;\n    const hx1 = x1 + Math.abs(x2 - x1) * curvature;\n    const hx2 = x2 - Math.abs(x2 - x1) * curvature;\n\n    return `M ${x1} ${y1} C ${hx1} ${y1} ${hx2} ${y2} ${x2} ${y2}`;\n}\n\nexport function renderPathData(emitter: Emitter<EventsTypes>, points: number[], connection?: Connection) {\n    const data = { points, connection, d: '' };\n    \n    emitter.trigger('connectionpath', data);\n    \n    return data.d || defaultPath(points, 0.4);\n}\n\nexport function updateConnection({ el, d } : { el: HTMLElement, d: string }) {\n    const path = el.querySelector('.connection path');\n\n    if (!path) throw new Error('Path of connection was broken');\n\n    path.setAttribute('d', d);\n}\n\nexport function renderConnection({ el, d, connection } : { el: HTMLElement, d: string, connection?: Connection }) {\n    const classed = !connection?[]:[\n        'input-' + toTrainCase(connection.input.name),\n        'output-' + toTrainCase(connection.output.name),\n        'socket-input-' + toTrainCase(connection.input.socket.name),\n        'socket-output-' + toTrainCase(connection.output.socket.name)\n    ];\n\n    const svg = document.createElementNS('http://www.w3.org/2000/svg', 'svg')\n    const path = document.createElementNS('http://www.w3.org/2000/svg', 'path')\n\n    svg.classList.add('connection', ...classed);\n    path.classList.add('main-path');\n    path.setAttribute('d', d);\n\n    svg.appendChild(path);\n    el.appendChild(svg);\n\n    updateConnection({ el, d });\n}","import { Output, Input, Emitter } from 'rete';\nimport { EditorView } from 'rete/types/view/index';\nimport { EventsTypes } from 'rete/types/events';\nimport { renderConnection, renderPathData, updateConnection } from '../utils';\n\nexport class PickerView {\n\n    private el: HTMLElement;\n\n    constructor(\n        private emitter: Emitter<EventsTypes>,\n        private editorView: EditorView\n    ) {\n        this.el = document.createElement('div');\n        this.editorView.area.appendChild(this.el);\n    }\n\n    updatePseudoConnection(io: Output | Input | null) {\n        if (io !== null) {\n            this.renderConnection(io);\n        } else if (this.el.parentElement) {\n            this.el.innerHTML = '';\n        }\n    }\n\n    private getPoints(io: Output | Input): number[] {\n        const mouse = this.editorView.area.mouse;\n\n        if(!io.node) throw new Error('Node in output/input not found')\n    \n        const node = this.editorView.nodes.get(io.node);\n\n        if(!node) throw new Error('Node view not found')\n    \n        const [x1, y1] = node.getSocketPosition(io);\n\n        return io instanceof Output\n            ? [x1, y1, mouse.x, mouse.y]\n            : [mouse.x, mouse.y, x1, y1];\n    }\n\n    updateConnection(io: Output | Input) {\n        const d = renderPathData(this.emitter, this.getPoints(io));\n\n        updateConnection({ el: this.el, d });\n    }\n\n    renderConnection(io: Output | Input) {\n        const d = renderPathData(this.emitter, this.getPoints(io));\n\n        renderConnection({ el: this.el, d });\n    }\n}","import { NodeEditor, Input, Output, Connection } from 'rete';\nimport { PickerView } from './view';\n\nexport class Picker {\n\n    private editor: NodeEditor;\n    private _io: Output | Input | null = null;\n    public view: PickerView;\n\n    constructor(editor: NodeEditor) {\n        this.editor = editor;\n        this.view = new PickerView(editor, editor.view);\n\n        editor.on('mousemove', () => this.io && this.view.updateConnection(this.io));\n    }\n\n    get io() : Output | Input | null {\n        return this._io;\n    }\n\n    set io(io: Output | Input | null) {\n        this._io = io;\n        this.view.updatePseudoConnection(io);\n    }\n\n    reset() {\n        this.io = null;\n    }\n\n    pickOutput(output: Output) {\n        if (!this.editor.trigger('connectionpick', output)) return;\n        \n        if (this.io instanceof Input) {\n            if(!output.multipleConnections && output.hasConnection())\n                this.editor.removeConnection(output.connections[0])\n    \n            this.editor.connect(output, this.io);\n            this.reset();\n            return;\n        }\n\n        if (this.io) this.reset();\n        this.io = output;\n    }\n\n    pickInput(input: Input) {\n        if (!this.editor.trigger('connectionpick', input)) return;\n\n        if (this.io === null) {\n            if (input.hasConnection()) {\n                this.io = input.connections[0].output;\n                this.editor.removeConnection(input.connections[0]);\n            } else {\n                this.io = input;\n            }\n            return true;\n        }\n\n        if (!input.multipleConnections && input.hasConnection())\n            this.editor.removeConnection(input.connections[0]);\n        \n        if (!this.io.multipleConnections && this.io.hasConnection())\n            this.editor.removeConnection(this.io.connections[0]);\n        \n        if (this.io instanceof Output && this.io.connectedTo(input)) {\n            let connection = input.connections.find(c => c.output === this.io);\n\n            if(connection) {\n                this.editor.removeConnection(connection);\n            }\n        }\n\n        if(this.io instanceof Output) {\n            this.editor.connect(this.io, input);\n            this.reset();\n        }\n    }\n\n    pickConnection(connection: Connection) {\n        const { output } = connection;\n\n        this.editor.removeConnection(connection);\n        this.io = output;\n    }\n}","import { IO, Input, Output } from 'rete';\nimport { Picker } from './picker';\n\nexport type FlowParams = { input?: Input, output?: Output };\n\nexport class Flow {\n\n    private picker: Picker;\n    private target?: IO | null;\n\n    constructor(picker: Picker) {\n        this.picker = picker;\n        this.target = null;\n    }\n\n    private act({ input, output }: FlowParams) {\n        if (this.unlock(input || output)) return\n\n        if (input)\n            this.picker.pickInput(input)\n        else if (output)\n            this.picker.pickOutput(output)\n        else\n            this.picker.reset();\n    }\n\n    public start(params: FlowParams, io?: IO) {\n        this.act(params);\n        this.target = io;\n    }\n\n    public complete(params: FlowParams = {}) {\n        this.act(params);\n    }\n\n    public hasTarget() {\n        return Boolean(this.target);\n    }\n\n    private unlock(io?: IO) {\n        const target = this.target;\n\n        this.target = null;\n\n        return target && target === io;\n    }\n}","import { NodeEditor } from 'rete';\nimport { renderConnection, renderPathData, updateConnection } from './utils';\nimport { Picker } from './picker';\nimport { Flow } from './flow';\nimport { FlowElement } from './types';\nimport './events';\nimport './index.sass';\n\nfunction install(editor: NodeEditor) {\n    editor.bind('connectionpath');\n    editor.bind('connectiondrop');\n    editor.bind('connectionpick');\n    \n    const picker = new Picker(editor);\n    const flow = new Flow(picker);\n    \n    function pointerDown(this: HTMLElement, e: PointerEvent) {\n        const flowEl = (this as any as FlowElement)._reteConnectionPlugin;\n\n        if(flowEl) {\n            const { input, output } = flowEl;\n            \n            editor.view.container.dispatchEvent(new PointerEvent('pointermove', e));\n            e.stopPropagation();\n            flow.start({ input, output }, input || output);\n        }\n    }\n\n    function pointerUp(this: Window, e: PointerEvent) {\n        if(!flow.hasTarget()) return; // don't handle pointerup if the target isn't set for this editor instance\n        const flowEl = document.elementFromPoint(e.clientX, e.clientY) as FlowElement;\n\n        if(picker.io) {\n            editor.trigger('connectiondrop', picker.io)\n        }\n        if(flowEl) {\n            flow.complete(flowEl._reteConnectionPlugin)\n        }\n    }\n\n\n    editor.on('rendersocket', ({ el, input, output }) => {\n        const flowEl = el as any as FlowElement;\n        flowEl._reteConnectionPlugin = { input, output };\n\n        el.removeEventListener('pointerdown', pointerDown);\n        el.addEventListener('pointerdown', pointerDown);\n    });\n\n    window.addEventListener('pointerup', pointerUp);\n\n    editor.on('renderconnection', ({ el, connection, points }) => {\n        const d = renderPathData(editor, points, connection);\n\n        renderConnection({ el, d, connection })\n    });\n\n    editor.on('updateconnection', ({ el, connection, points }) => {\n        const d = renderPathData(editor, points, connection);\n\n        updateConnection({ el, d });\n    });\n\n    editor.on('destroy', () => {\n        window.removeEventListener('pointerup', pointerUp);\n    });\n}\n\nexport default {\n    name: 'connection',\n    install\n}\nexport { defaultPath } from './utils';"],"names":["toTrainCase","str","toLowerCase","replace","defaultPath","points","curvature","x1","y1","x2","y2","hx1","Math","abs","hx2","renderPathData","emitter","connection","data","d","trigger","updateConnection","el","path","querySelector","Error","setAttribute","renderConnection","classed","input","name","output","socket","svg","document","createElementNS","classList","add","appendChild","PickerView","editorView","createElement","area","io","parentElement","innerHTML","mouse","node","nodes","get","getSocketPosition","Output","x","y","getPoints","Picker","editor","view","on","Input","multipleConnections","hasConnection","removeConnection","connections","connect","reset","connectedTo","find","c","_io","updatePseudoConnection","Flow","picker","target","unlock","pickInput","pickOutput","params","act","Boolean","install","bind","flow","pointerDown","e","flowEl","_reteConnectionPlugin","container","dispatchEvent","PointerEvent","stopPropagation","start","pointerUp","hasTarget","elementFromPoint","clientX","clientY","complete","removeEventListener","addEventListener","window"],"mappings":"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"}